/* eslint-disable import/no-extraneous-dependencies */
/* eslint-disable no-console */

const fs = require('fs')
const fg = require('fast-glob')
const { minify } = require('html-minifier-terser')

const files = fg.sync(['public/**/*.html'])

const options = {
  caseSensitive: true,
  collapseBooleanAttributes: true,
  collapseWhitespace: true,
  continueOnParseError: true,
  includeAutoGeneratedTags: false,
  keepClosingSlash: true,
  maxLineLength: 0,
  minifyCSS: true,
  minifyJS: true,
  removeComments: true,
  removeEmptyAttributes: true,
  removeOptionalTags: true,
  removeRedundantAttributes: true,
  removeScriptTypeAttributes: true,
  removeStyleLinkTypeAttributes: true,
  sortAttributes: true,
  sortClassName: true,
  trimCustomFragments: true,
  useShortDoctype: true
}

files.forEach(async file => {
  const htmlTerser = await minify(fs.readFileSync(file, 'utf8'), options)

  fs.writeFileSync(file, htmlTerser, 'utf8')
})
